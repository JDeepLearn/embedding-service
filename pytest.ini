# ===================================================================
# Pytest Configuration - Embedding Service
# ===================================================================
# Purpose:
#   Provides consistent test behavior across local, CI/CD, and Docker.
#   Disables noisy plugins, enforces clean output, and sets safe defaults.
# ===================================================================

[pytest]
# ------------------------------
# Test discovery
# ------------------------------
testpaths = 
    tests

python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ------------------------------
# Default options
# ------------------------------
addopts = 
    -q                     # Quiet output (short test summary)
    --disable-warnings      # Suppress unnecessary warnings
    --maxfail=1             # Stop after first failure (faster CI)
    --tb=short              # Short tracebacks for CI logs
    --color=yes             # Colorized output for local readability

# ------------------------------
# Plugin controls
# ------------------------------
# Disable 3rd-party pytest plugins that may load globally (e.g., from Anaconda)
# This prevents unexpected dependency imports (like dash/flask)
# ------------------------------
# Example: disable dash plugin that causes Flask import errors
# -------------------------------------
# Add any others if needed later (e.g., no:xdist)
# -------------------------------------
# You can discover plugin names by running: pytest --trace-config
# -------------------------------------
# These directives protect CI and local runs from cross-env contamination.
# -------------------------------------
addopts = -p no:dash

# ------------------------------
# Logging & output control
# ------------------------------
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_date_format = %Y-%m-%d %H:%M:%S

# ------------------------------
# Failures and exit behavior
# ------------------------------
# CI/CD pipelines can use exit codes for quality gates
# 0 = all pass, 1 = failures, 2 = user interruption, 3 = internal error
# ------------------------------
junit_family = xunit2

# ------------------------------
# Cache & environment stability
# ------------------------------
# Disable caching plugins for deterministic behavior across runs
# ------------------------------
cache_dir = .pytest_cache